'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var _tslib = require('../../../../../_virtual/_tslib.cjs');
var api = require('../../../data/api.cjs');

const createEmailHandler = (environmentId, createUserProfileByJWT) => (email) => _tslib.__awaiter(void 0, void 0, void 0, function* () {
    const { verificationUUID } = yield api.createEmailVerification({
        email,
        environmentId,
    });
    return {
        verify: (oneTimePassword) => _tslib.__awaiter(void 0, void 0, void 0, function* () {
            const { jwt } = yield api.signInWithEmailVerification({
                environmentId,
                verificationToken: oneTimePassword,
                verificationUUID,
            });
            yield createUserProfileByJWT(jwt);
            return {
                email,
                verified: Boolean(jwt),
            };
        }),
    };
});

exports.createEmailHandler = createEmailHandler;
