{"version":3,"file":"provider-adapter.js","sourceRoot":"","sources":["../../src/provider-adapter.ts"],"names":[],"mappings":"AAAA,OAAO,EACL,wBAAwB,EACxB,oBAAoB,EACpB,QAAQ,GAQT,MAAM,kBAAkB,CAAC;AAC1B,OAAO,EAAE,cAAc,EAAE,MAAM,2BAA2B,CAAC;AAC3D,OAAO,EAAE,eAAe,EAAE,MAAM,0BAA0B,CAAC;AAC3D,OAAO,EAAE,aAAa,EAAE,MAAM,qBAAqB,CAAC;AAGpD,MAAM,OAAO,qBAAsB,SAAQ,eAAe;IAExD,YACE,WAAwD,EACxD,iBAA0B,EAC1B,OAAe;QAEf,KAAK,EAAE,CAAC;QAND;;;;;WAAqD;QA+C9D;;;;mBAA0B,CAAC,SAG1B,EAAQ,EAAE;gBACT,IAAI,CAAC,eAAe,CAAC,uBAAuB,CAAC,SAAS,CAAC,CAAC;gBACxD,OAAO,IAAI,CAAC;YACd,CAAC;WAAC;QAEF;;;;mBAAmB,CAAC,QAAgC,EAAQ,EAAE;gBAC5D,IAAI,CAAC,eAAe,CAAC,gBAAgB,CAAC,QAAQ,CAAC,CAAC;gBAChD,OAAO,IAAI,CAAC;YACd,CAAC;WAAC;QAEF;;;;mBAAoB,CAAC,QAA2B,EAAQ,EAAE;gBACxD,IAAI,CAAC,eAAe,CAAC,iBAAiB,CAAC,QAAQ,CAAC,CAAC;gBACjD,OAAO,IAAI,CAAC;YACd,CAAC;WAAC;QAEF;;;;mBAAuB,CAAC,QAA6B,EAAQ,EAAE;gBAC7D,IAAI,CAAC,eAAe,CAAC,oBAAoB,CAAC,QAAQ,CAAC,CAAC;gBACpD,OAAO,IAAI,CAAC;YACd,CAAC;WAAC;QA7DA,MAAM,KAAK,GAAG,QAAQ,CAAC,OAAO,CAAC,CAAC;QAChC,IAAI,CAAC,eAAe,GAAG,IAAI,oBAAoB,CAC7C,WAAW,EACX,iBAAiB,EACjB,KAAK,CACN,CAAC;IACJ,CAAC;IAUD,IAAI,CAAC,MAAc,EAAE,MAAa;QAChC,OAAO,IAAI,CAAC,eAAe,CAAC,OAAO,CAAC,EAAE,MAAM,EAAE,MAAM,EAAE,CAAC,CAAC;IAC1D,CAAC;IAQD,gBAAgB,CACd,EAAgE;QAEhE,cAAc,CAAC,IAAI,EAAE,iBAAiB,EAAE,IAAI,CAAC,eAAe,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC,CAAC;QAC1E,OAAO,IAAI,CAAC,gBAAgB,EAAE,CAAC;IACjC,CAAC;IAKD,gBAAgB;QACd,OAAO,IAAI,aAAa,CAAC,IAAI,CAAC,CAAC;IACjC,CAAC;IAyBD,sBAAsB;QACpB,OAAO,IAAI,CAAC,eAAe,CAAC,SAAS,CAAC;IACxC,CAAC;IAOD,MAAM,CAAC,kBAAkB,CACvB,QAAyB,EACzB,iBAA0B;QAE1B,OAAO,IAAI,qBAAqB,CAC9B,QAAQ,CAAC,UAAU,CAAC,GAAG,EACvB,iBAAiB,EACjB,QAAQ,CAAC,OAAO,CAAC,OAAO,CACzB,CAAC;IACJ,CAAC;CACF","sourcesContent":["import {\n  BaseSmartContractAccount,\n  SmartAccountProvider,\n  getChain,\n  type AccountMiddlewareFn,\n  type Address,\n  type FeeDataMiddleware,\n  type GasEstimatorMiddleware,\n  type HttpTransport,\n  type PaymasterAndDataMiddleware,\n  type PublicErc4337Client,\n} from \"@alchemy/aa-core\";\nimport { defineReadOnly } from \"@ethersproject/properties\";\nimport { JsonRpcProvider } from \"@ethersproject/providers\";\nimport { AccountSigner } from \"./account-signer.js\";\n\n/** Lightweight Adapter for SmartAccountProvider to enable Signer Creation */\nexport class EthersProviderAdapter extends JsonRpcProvider {\n  readonly accountProvider: SmartAccountProvider<HttpTransport>;\n  constructor(\n    rpcProvider: string | PublicErc4337Client<HttpTransport>,\n    entryPointAddress: Address,\n    chainId: number\n  ) {\n    super();\n    const chain = getChain(chainId);\n    this.accountProvider = new SmartAccountProvider(\n      rpcProvider,\n      entryPointAddress,\n      chain\n    );\n  }\n\n  /**\n   * Rewrites the send method to use the account provider's EIP-1193\n   * compliant request method\n   *\n   * @param method - the RPC method to call\n   * @param params - the params required by the RPC method\n   * @returns the result of the RPC call\n   */\n  send(method: string, params: any[]): Promise<any> {\n    return this.accountProvider.request({ method, params });\n  }\n\n  /**\n   * Connects the Provider to an Account and returns a Signer\n   *\n   * @param fn - a function that takes the account provider's rpcClient and returns a BaseSmartContractAccount\n   * @returns an {@link AccountSigner} that can be used to sign and send user operations\n   */\n  connectToAccount(\n    fn: (rpcClient: PublicErc4337Client) => BaseSmartContractAccount\n  ): AccountSigner {\n    defineReadOnly(this, \"accountProvider\", this.accountProvider.connect(fn));\n    return this.getAccountSigner();\n  }\n\n  /**\n   * @returns an {@link AccountSigner} using this as the underlying provider\n   */\n  getAccountSigner(): AccountSigner {\n    return new AccountSigner(this);\n  }\n\n  withPaymasterMiddleware = (overrides: {\n    dummyPaymasterDataMiddleware?: PaymasterAndDataMiddleware;\n    paymasterDataMiddleware?: PaymasterAndDataMiddleware;\n  }): this => {\n    this.accountProvider.withPaymasterMiddleware(overrides);\n    return this;\n  };\n\n  withGasEstimator = (override: GasEstimatorMiddleware): this => {\n    this.accountProvider.withGasEstimator(override);\n    return this;\n  };\n\n  withFeeDataGetter = (override: FeeDataMiddleware): this => {\n    this.accountProvider.withFeeDataGetter(override);\n    return this;\n  };\n\n  withCustomMiddleware = (override: AccountMiddlewareFn): this => {\n    this.accountProvider.withCustomMiddleware(override);\n    return this;\n  };\n\n  getPublicErc4337Client(): PublicErc4337Client {\n    return this.accountProvider.rpcClient;\n  }\n\n  /**\n   * @param provider - the ethers JSON RPC provider to convert\n   * @param entryPointAddress - the entrypoint address that will be used for UserOperations\n   * @returns an instance of {@link EthersProviderAdapter}\n   */\n  static fromEthersProvider(\n    provider: JsonRpcProvider,\n    entryPointAddress: Address\n  ): EthersProviderAdapter {\n    return new EthersProviderAdapter(\n      provider.connection.url,\n      entryPointAddress,\n      provider.network.chainId\n    );\n  }\n}\n"]}